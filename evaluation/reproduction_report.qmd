---
title: "Summary report"
subtitle: "For computational reproducibility assessment of Author et al. Year"
format:
  html:
    page-layout: full
echo: False
bibliography: ../quarto_site/references.bib
---

<!-- TODO: Remove this warning once filled out report -->
**Please note: This is a template page and has not yet been completed**

<!-- TODO: Use this skeleton to create a summary report -->

## Study

> [Authors]. **[Title]**. *[Journal]* [Volume], [Edition] ([Year]). <[URL]>.

[Paragraph summarising model]

Images on this page are sourced from @shoaib_simulation_2021, which is shared under [CC BY-NC-ND](http://creativecommons.org/licenses/by-nc-nd/4.0/).

## Computational reproducibility

Successfully reproduced **16 out of 17 (94%)** of items in the scope in **28h 14m (70.6%)**.

Required troubleshooting:

* [List of required changes to code]

::: {.panel-tabset}

## Table 6

```{python}
import pandas as pd
import dataframe_image as dfi

file = '../reproduction/outputs/tab6'
df = pd.read_csv(f'{file}.csv')
dfi.export(df, f'{file}.png')
```

![Original](../original_study/tab6.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/tab6.png){width=49% .lightbox}

<!-- Example:

![Original](../original_study/article_fig2.png){width=49% .lightbox}
![Reproduction](../reproduction/output/patients_base_3_month.png){width=49% .lightbox} -->

## Figure 2A

![Original](../original_study/fig2a.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig2a.png){width=49% .lightbox}

## Figure 2B

![Original](../original_study/fig2b.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig2b.png){width=49% .lightbox}

## Figure 2C

![Original](../original_study/fig2c.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig2c.png){width=49% .lightbox}

## Figure 2D

![Original](../original_study/fig2d.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig2d.png){width=49% .lightbox}

## Figure 3A

![Original](../original_study/fig3a.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig3a.png){width=49% .lightbox}

## Figure 3B

![Original](../original_study/fig3b.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig3b.png){width=49% .lightbox}

## Figure 3C

![Original](../original_study/fig3c.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig3c.png){width=49% .lightbox}

## Figure 3D

![Original](../original_study/fig3d.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig3d.png){width=49% .lightbox}

## Figure 4

![Original](../original_study/fig4.png){width=49% .lightbox}
![Reproduction](../reproduction/outputs/fig4.png){width=49% .lightbox}

## In-text result 1

"We also note that waiting times for outpatient-related resources (laboratory, OPD consultation, etc. - not depicted in Figures 3a – 3d) increase marginally because the associated resources are also required by inpatient/childbirth/ANC cases, which increase in number in the above scenarios"

```{python}
pd.read_csv('../reproduction/outputs/intext1.csv')
```

## In-text result 2

"To address this, we experimented with letting the staff nurse (whose utilisation is approximately 32%) take over the administrative work. This led to a 12% drop in the utilisation level, which implied that the doctor’s utilisation still exceeded 100%. Implementing this measure resulted in increasing the staff nurse utilisation to nearly 40%."

```{python}
pd.read_csv('../reproduction/outputs/intext2.csv')
```

## In-text result 3

"...then considered a situation wherein the staff nurses require minimal intervention in childbirth cases. We assumed that in 50% of childbirth cases, staff nurses require no intervention by the doctor; require only one- third of the typical amount of intervention in 30% of cases, and require full intervention in the remaining 20% of cases. This led to a decrease of the doctor’s utilisation to 101% (a further decrease of approximately 1%), and an increase in the nurse’s utilisation to 40%."

```{python}
pd.read_csv('../reproduction/outputs/intext3.csv')
```

## In-text result 4

"..investigated the effect of stationing an additional doctor in the PHC. This yielded an average utilisation of well below 100% for each doctor."

```{python}
pd.read_csv('../reproduction/outputs/intext4.csv')
```

## In-text result 5

"We also observe that if the number of beds is reduced to four from six, the utilisation level is observed to be approximately thirty-three percent even under higher demand conditions (two inpatient and childbirth cases/day)."

```{python}
pd.read_csv('../reproduction/outputs/intext5.csv')
```

## In-text result 6

"When the administrative work alone is assigned to the staff nurse the average utilisation of the NCD nurse decreases to 100%"

```{python}
pd.read_csv('../reproduction/outputs/intext6.csv')
```

## In-text result 7

"Further, in addition to the administrative work when the staff nurse assisted for NCD checks (for 10% cases) the utilisation of NCD nurse dropped to 71%."

```{python}
pd.read_csv('../reproduction/outputs/intext7.csv')
```

:::

## Evaluation against guidelines

```{python}
import pandas as pd
import plotly.express as px

# Create dataframe of results
col = ['fully', 'partially', 'not', 'na']
eval_dict = {
  'STARS (essential)': [3, 0, 5, 0],
  'STARS (optional)': [0, 0, 5, 0],
  'Badges (criteria)': [5, 0, 7, 0],
  'Badges (badges)': [5, 0, 7, 0],
  'STRESS-DES': [17, 6, 1, 0],
  'ISPOR-SDM': [12, 2, 3, 1]
}
eval_wide = pd.DataFrame(eval_dict, index=col).T
eval = (eval_wide
        .melt(ignore_index=False)
        .reset_index()
        .rename(columns={'index': 'guideline',
                         'variable': 'result',
                         'value': 'count'}))

# Add percentages
eval['total'] = eval['count'].groupby(eval['guideline']).transform('sum')
eval['percent'] = eval['count'] / eval['total']
eval['percentage'] = round(eval['percent']*100, 1).astype(str) + '%'

# Create stacked bar visualisation
fig = px.bar(
  eval,
  x='percent',
  y='guideline',
  color='result',
  color_discrete_map={'fully': '#06a94d',
                      'partially': '#ffd68c',
                      'not': '#ff9999',
                      'na': '#d1dcea'},
  orientation='h',
  hover_data={
    'count': True,
    'percent': False,
    'percentage': True,
    'guideline': False,
    'result': False})
  
# Amend x axis label and ticks
fig.update_layout(xaxis = dict(
  range=[0,1],
  tickmode='array',
  tickvals=[0, 0.2, 0.4, 0.6, 0.8, 1],
  ticktext=['0%', '20%', '40%', '60%', '80%', '100%'],
  title=''))

# Amend y axis label and order, and add space between ticks and plot
fig.update_layout(yaxis=dict(
  autorange='reversed',
  title=''))
fig.update_yaxes(ticksuffix = '  ')

# Relabel legend
fig.update_layout(legend_title_text='Result')
newnames = {'fully': 'Fully met', 'partially': 'Partially met',
            'not': 'Not met', 'na': 'Not applicable'}
fig.for_each_trace(lambda t: t.update(name = newnames[t.name]))

# Show without toolbar
fig.show(config={'displayModeBar': False})
```

<sup>Context: The original study repository was evaluated against criteria from journal badges relating to how open and reproducible the model is and against guidance for sharing artefacts from the STARS framework. The original study article and supplementary materials (excluding code) were evaluated against reporting guidelines for DES models: STRESS-DES, and guidelines adapted from ISPOR-SDM.</sup>
